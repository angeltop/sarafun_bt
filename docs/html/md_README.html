<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Sarafun Behavior Trees package: Behavior Trees for the SARAFun project [![Build Status](https://travis-ci.org/diogoalmeida/sarafun_bt.svg?branch=master)](https://travis-ci.org/diogoalmeida/sarafun_bt)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Sarafun Behavior Trees package
   &#160;<span id="projectnumber">1</span>
   </div>
   <div id="projectbrief">Behavior trees for the SARAFun project</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Behavior Trees for the SARAFun project [![Build Status](<a href="https://travis-ci.org/diogoalmeida/sarafun_bt.svg?branch=master">https://travis-ci.org/diogoalmeida/sarafun_bt.svg?branch=master</a>)](<a href="https://travis-ci.org/diogoalmeida/sarafun_bt">https://travis-ci.org/diogoalmeida/sarafun_bt</a>) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This repository contains code that showcases a potential application of behavior trees. It provides:</p>
<ul>
<li>A <code>sarafun_tree</code> ROS package. It provides the required utilities for running a behavior tree in the context of the SARAFun EU project.</li>
<li>Dummy packages <code>sarafun_manipulation</code>, <code>sarafun_generic_al_server</code> and <code>sarafun_assembly</code>, that implement <a href="http://wiki.ros.org/actionlib">actionlib</a> servers for interacting with the behavior tree.</li>
</ul>
<p>It depends on a modified version of the <a href="https://github.com/miccol/ROS-Behavior-Tree">ROS-Behavior-Tree</a> package by Michele Colledanchise. The main changes are</p>
<ul>
<li>Support for the creation of a Behavior Tree from an input file</li>
<li>Inclusion of the classes <code>ActionTemplate</code> and <code>ConditionTemplate</code>, and their exposure as libraries.</li>
</ul>
<p>The modified package is found <a href="https://github.com/diogoalmeida/ROS-Behavior-Tree">here</a>.</p>
<h2>Instalation </h2>
<h3>Compiler</h3>
<p>There is an <a href="https://github.com/nlohmann/json/pull/212">issue</a> with gcc 4.8 that prevents compiling the json parser used in this project. So first, make sure you have a more recent version of gcc. In ubuntu this can be achieved by doing ``` $ sudo add-apt-repository ppa:ubuntu-toolchain-r/test $ sudo apt-get update $ sudo apt-get install gcc-4.9 g++-4.9 ``` and your system should now be correctly configured.</p>
<h3>Dependencies</h3>
<p>The provided packages depend on <a href="https://github.com/oftc/yaml-cpp.git">yaml-cpp</a>.</p>
<h3>ROS packages</h3>
<p>If you do not have a created catkin workspace, create one by doing ``` $ mkdir ~/catkin_ws $ mkdir ~/catkin_ws/src $ cd ~/catkin_ws $ catkin_make ``` Otherwise skip this step. Go to the src folder of your catkin workspace and introduce the following commands ``` $ wstool init $ wstool merge <a href="https://raw.githubusercontent.com/diogoalmeida/sarafun_bt/master/.rosinstall">https://raw.githubusercontent.com/diogoalmeida/sarafun_bt/master/.rosinstall</a> $ wstool update <code> This will download the</code>ROS-Behavior-Tree<code>package, as well as the SARAFun packages required for running the demo. Compile the packages by doing</code>$ catkin_make -DCMAKE_CXX_COMPILER=/usr/bin/g++-4.9 install<code>at the root of your workspace. After compiling, do not forget to source the workspace: </code> $ source devel/setup.bash ```</p>
<h3>YAML parser</h3>
<p>These packages depend on yaml-cpp, version 0.5.3, which can be obtained <a href="https://github.com/jbeder/yaml-cpp/tree/yaml-cpp-0.5.3">here</a></p>
<h2>Services </h2>
<p>The tree client provides services to start, stop and restart a tree. When starting, the tree client will parse the input file and generate a tree based on it. Restarting a tree stops the currently running tree, parses the input file and generates a new one based on it. The provided services are:</p>
<ul>
<li><code>/sarafun/start_tree</code></li>
<li><code>/sarafun/stop_tree</code></li>
<li><code>/sarafun/restart_tree</code></li>
</ul>
<p>The start service requires a file path to be given. This will be used by the json parser to load the appropriate tree.</p>
<h2>Running the demo </h2>
<p>This package provides two demos:</p>
<ul>
<li>The first demo is used to illustrate the BT functionality. It runs the tree defined in <code>sarafun_tree/data/example_demo1.json</code>, and each action will prompt the user to enter the key "p" for preempting the action, "a" to abort it and anything else to succeed. Preempting or aborting an action results in a <code>FAILURE</code> state in the behavior tree. Edit the <code>sarafun_tree/data/example_demo1.json</code> file in order to test different tree configurations! To run this demo, type ``` $ roslaunch sarafun_tree run_sarafun_bt_demo.launch demo1:=true ```</li>
<li>The second demo showcases preemption and conditions. We modified the <a href="https://github.com/auth-arl/sarafun_online_motion_generation">online motion generator provided CERTH</a> so that it implements an actionlib server. The modified code can be found <a href="https://github.com/diogoalmeida/sarafun_online_motion_generation">here</a> and illustrates how an action should take into account that it can be preempted. To run this demo, type ``` $ roslaunch sarafun_tree run_sarafun_bt_demo.launch demo2:=true ```</li>
</ul>
<p>To start execution, call the <code>/sarafun/start_tree</code> service.</p>
<p><b>NOTE</b>: The online motion generator requires the <code>abb_irb14000_support</code> package, which is not freely available. You can find the robot description in <a href="https://github.com/rtkg/yumi">this repository</a>.</p>
<p>This will run a simple tree with 5 actions. Each action will command the robot to move to a different position. The two main subtrees execution depends on the output of the simple condition in the first one. This will be true for the first x ticks on the tree (defined in the launch file under <code>/IsSimple/count_limit</code>. When the condition becomes false, the running action will be preempted, and the second subtree is executed, where the first action under the selector asks the robot to achieve an unreachable goal, and is thus preempted after the timeout period has expired.</p>
<h2>Creating a different tree </h2>
<p>The behavior tree package takes a json file as input in order to generate the tree. The file is located in <code>sarafun_tree/data</code> and its name is given by the ROS parameter <code>/sarafun/bt/file</code>. If the parameter is not set, it will use the default name <code>example.json</code>.</p>
<p>The file defines the tree by specifying its root and a list of nodes. A node can be a flow control node or a leaf node. It is defined by its <code>id</code>, <code>type</code> and <code>name</code> tags and, for the flow control nodes only, by a list of children (<code>children</code>) which contains the <code>id</code>s of the children nodes. The <code>id</code> tag should be unique, and it is used to refer to a particular instance of the behavior tree node. <code>type</code> determines the what is the node functionality (see <a href="#Currently-supported-node-types">below</a>). Finally, the <code>name</code> tag is currently only used by the leaf nodes. It specifies the actionlib server name that the concrete action implementation uses and it is used by the behavior tree in order to call the server.</p>
<p>A simple example is as follows ```json { "root": "sequence1", "nodes": { "sequence1": { "id": "sequence1", "type": "SequenceStar", "name": "SequenceStar", "children": [ "action1", "selector1" ] }, "selector1": { "id": "selector1", "type": "Selector", "name": "Selector", "children": [ "action2", "action3" ] }, "action1": { "id": "action1", "type": "Action", "name": "action_1" }, "action2": { "id": "action2", "type": "Action", "name": "action_2" }, "action3": { "id": "action3", "type": "Action", "name": "action_3" } } } ```</p>
<h3>Currently supported node types</h3>
<p>There are four currently supported flow control nodes and two possible leaf node types, which are defined in the json file by the <code>type</code> property:</p>
<ul>
<li><b>Sequence</b>: The sequence node ticks its children sequentially every time it receives a tick from its parent node. Returns <code>FAILURE</code> as soon as one of its children returns <code>FAILURE</code>, or <code>SUCCESS</code> in case all of its children are successful</li>
<li><b>Selector</b>: The selector node ticks its children sequentially every time it receives a tick from its parent node. Returns <code>SUCCESS</code> as soon as one of its children returns <code>SUCCESS</code>, or <code>FAILURE</code> in case all of its children are successful</li>
<li><b>SequenceStar</b>: The same as Sequence, but with memory, that is, every time it receives a tick from its parent, it will skip tick'ing all the children that previously returned <code>SUCCESS</code></li>
<li><b>SelectorStar</b>: The same as Selector, but with memory, that is, every time it receives a tick from its parent, it will skip tick'ing all the children that previously returned <code>FAILURE</code></li>
<li><b>Action</b>: An action will execute some well defined program when it is tick'ed, and will return <code>SUCCESS</code> or <code>FAILURE</code> at the end of its execution, according to the implementation. While executing, it will return <code>RUNNING</code></li>
<li><b>Condition</b>: A condition is similar to an action, but it is meant to return <code>SUCCESS</code> or <code>FAILURE</code> as soon as it tick'ed, and should be used to help the behavior tree logic by verifying some condition.</li>
</ul>
<h2>Tree visualization </h2>
<p>The BT engine provides a basic openGL tree visualization. An arbitrary tree may not be rendered adequately, in which case the user can use the keyboard to ajust the tree:</p>
<ul>
<li>The directional arrows on the keyboard will translate the tree on the visualization window;</li>
<li>Page up will zoom the tree in, page down will zoom out. </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Feb 16 2017 14:54:51 for Sarafun Behavior Trees package by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
